{
  "service": {
    "name": "stocks-api"
  },
  "package": {
    "individually": true,
    "exclude": [
      "**/**"
    ]
  },
  "plugins": [
    "serverless-aws-documentation"
  ],
  "custom": {
    "documentation": {
      "api": {
        "info": {
          "version": "1.0.0",
          "title": "${self:service.name}",
          "description": "Stocks management API"
        }
      }
    }
  },
  "provider": {
    "name": "aws",
    "runtime": "nodejs12.x",
    "stackName": "${self:service.name}-stack",
    "apiName": "${self:service.name}",
    "stage": "${opt:stage, 'prod'}",
    "region": "eu-central-1",
    "deploymentBucket": {
      "name": "kaskadi-serverless-deployment-bucket"
    },
    "stackTags" : {
      "app": "kaskadi"
    },
    "tags": {
      "app": "kaskadi",
      "service": "${self:service.name}",
      "logical-unit": "stocks",
      "type": "schedule and http"
    }
  },
  "functions": {
    "RequestAmzStocksUpdate": "${file(./lambdas/hello-world/serverless.json)}"
  },
  "layers": {
    "ApiLayer": "${file(./layer/serverless.json)}"
  },
  "resources": {
    "Resources": {
      "CognitoAuthorizer": {
        "DependsOn": [
          "ApiGatewayRestApi"
        ],
        "Type": "AWS::ApiGateway::Authorizer",
        "Properties": {
          "Name": "cognito-authorizer",
          "IdentitySource": "method.request.header.Authorization",
          "RestApiId": {
            "Ref": "ApiGatewayRestApi"
          },
          "Type": "COGNITO_USER_POOLS",
          "ProviderARNs": [
            {
              "ImportValue": "KaskadiCognitoUserPoolARN"
            }
          ]
        }
      }
    }
  }
}
